---
title: "Procesamiento de datos "
author: "Martín Venegas"
date: "10/14/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Procesamiento para análisis de "¿Quién justifica qué? El papel del sentido de (in)justicia en las justificaciones de violencia en contexto de protesta" - Estudio 1

El documento de código de preparación posee 2 partes, más una sección de identificación inicial:

## Procesamiento general

### Cargar las librerías a utilizar

```{r setup}
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instala

pacman::p_load(tidyverse, sjlabelled, ggplot2, sjmisc, kableExtra) # librerias

```

### Cargar base de datos orginal 

```{r load}
load("../input/data/ELSOC_Wide_2016_2019_v1.00_R.RData") # cargar base
```

### Seleccionar y renombrar variables

```{r select}

# Seleccionar y renombrar variables para el análisis
elsoc_procjv <- elsoc_wide_2016_2019 %>% select(idencuesta,
                                      # Variables dependientes
                                      ## Justificación violencia por el control social
                                      jv_carab1_2019 = f05_03_w04, # Carabineros reprimen marchas
                                      jv_carab2_2019 = f05_04_w04, # Carabineros desalojen tomas
                                      
                                      ## Justificacón violencia por el cambio social
                                      jv_trabaj_2019 = f05_06_w04, # Trabajadores corten calle
                                      jv_est_2019 = f05_07_w04, # Estudiantes tiren piedras
                                      jv_prop1_2019 = f05_09_w04, # Daño inmobiliario público
                                      jv_prop2_2019 = f05_10_w04, # Daño transporte público
                                      jv_prop3_2019 = f05_11_w04, # Daño comercio
                                      
                                      # Variables independientes
                                      ## Percepción trato justo
                                      trato_salud = c35_01_w04, # Trato respetuoso en servicios de salud
                                      trato_trabajo = c35_02_w04, # Trato respetuoso en el trabajo
                                      trato_carab = c35_03_w04, # Trato respetuoso carabineros
                                      trato_clasealta = c35_04_w04, # Trato respetuoso clase alta
                                      
                                      ## Justicia distributiva
                                      distjust_pensiones = d02_01_w04, # Justicia distributiva pensiones
                                      distjust_educ = d02_02_w04, # Justicia disteributiva educación hijos
                                      distjust_salud = d02_03_w04, # Justicia distributiva salud
                                      salario_perc_ceo = d03_01_w04, # Salario percibido CEO
                                      salario_perc_obrero = d03_02_w04, # Salario percibido obrero
                                      salario_just_ceo = d04_01_w04, # Salario justo CEO
                                      salario_just_obrero = d04_02_w04, # Salario justo obrero
                                      just_clases = d19_w04, # Justificacion diferencias clases
                                      
                                      ## Pertenencia a grupos desventajados
                                      ingreso = m13_w04, # Ingreso mensual (monyo)
                                      ingreso_tramos = m14_w04, # Ingreso mensual (tramos)
                                      ingreso_justo = m15_w04, # Ingreso considerado justo
                                      ingreso_satisfact = m16_w04, # Satisfacción con los ingresos
                                      educ = m01_w04, # Nivel educacional del entrevistado
                                      # educ_sost_2016 = m21_w01, # Nivel educacional sostenedor 2016
                                      # educ_sost_2018 = m21_w03, # Nivel educacional sostenedor 2018
                                      # educ_padre_2016 = m27_w01, # Nivel educacional padre 2016
                                      # educ_padre_2018 = m27_w03, # Nivel educacional padre 2018
                                      # educ_madre_2016 = m28_w01, # Nivel educacional madre 2016
                                      # educ_madre_2018 = m28_w03, # Nivel educascional madre 
                                      sexo = m0_sexo_w04, # Sexo del entrevistado
                                      
                                      # Variables de control
                                      
                                      edad = m0_edad_w04, # Edad del entrevistado
                                      comuna = comuna_w04, # Comuna
                                      pos_pol = c15_w04, # Posición política
                                      frec_marcha = c08_02_w04, # Frecuencia participación en marchas
                                      frec_huelga = c08_03_w04, # Frecuencia participación en huelgas
                                      conf_carab = c05_03_w04, # Confianza en carabineros
                                      religion = m38_w04, # Religión del entrevistado
                                      religion_otro = m38_otro_w04 # Religión otra del entrevistado
                                      )
```

## Procesamiento por variable

### Variables dependientes:

#### Justificación de violencia por el control social

##### Carabineros reprimen marchas

###### Descriptivo

```{r}
# Frecuencias
sjmisc::frq(elsoc_procjv$jv_carab1_2019)
```


###### Recodificación

```{r}
# Recoficiación NA
elsoc_procjv$jv_carab1_2019<- set_na(elsoc_procjv$jv_carab1_2019, na = c(-888,-999), drop.levels = TRUE, as.tag = FALSE)

# Creación variable factor
elsoc_procjv$jv_carab1_2019_factor <- factor(elsoc_procjv$jv_carab1_2019, levels = c(1,2,3,4,5), labels = c("Nunca se justifica", "Pocas veces se justifica", "Algunas veces se justifica", "Muchas veces se justifica", "Siempre se justifica"))

```


###### Descriptivo final

```{r}

# Variable original (númerica)
sjmisc::frq(elsoc_procjv$jv_carab1_2019)

# Variable factor
sjmisc::frq(elsoc_procjv$jv_carab1_2019_factor)
```

##### Carabineros desalojan tomas

###### Descriptivo

```{r}
# Frecuencias
sjmisc::frq(elsoc_procjv$jv_prop1_2019)
```


###### Recodificación

```{r}
# Recoficiación NA
elsoc_procjv$jv_carab2_2019<- set_na(elsoc_procjv$jv_carab2_2019, na = c(-888,-999), drop.levels = TRUE, as.tag = FALSE)

# Creación variable factor
elsoc_procjv$jv_carab2_2019_factor <- factor(elsoc_procjv$jv_carab2_2019, levels = c(1,2,3,4,5), labels = c("Nunca se justifica", "Pocas veces se justifica", "Algunas veces se justifica", "Muchas veces se justifica", "Siempre se justifica"))

```


###### Descriptivo final

```{r}

# Variable original (númerica)
sjmisc::frq(elsoc_procjv$jv_carab2_2019)

# Variable factor
sjmisc::frq(elsoc_procjv$jv_carab2_2019_factor)
```


#### Justificación de violencia por el cambio social

##### Estudiantes tiran piedras

###### Descriptivo

```{r}
# Frecuencias
sjmisc::frq(elsoc_procjv$jv_est_2019)
```


###### Recodificación

```{r}
# Recoficiación NA
elsoc_procjv$jv_est_2019<- set_na(elsoc_procjv$jv_est_2019, na = c(-888,-999), drop.levels = TRUE, as.tag = FALSE)

# Creación variable factor
elsoc_procjv$jv_est_2019_factor <- factor(elsoc_procjv$jv_est_2019, levels = c(1,2,3,4,5), labels = c("Nunca se justifica", "Pocas veces se justifica", "Algunas veces se justifica", "Muchas veces se justifica", "Siempre se justifica"))

```


###### Descriptivo final

```{r}

# Variable original (númerica)
sjmisc::frq(elsoc_procjv$jv_est_2019)

# Variable factor
sjmisc::frq(elsoc_procjv$jv_est_2019_factor)
```


##### Trabajadores cortan calle (para análisis exploratorio)

###### Descriptivo

```{r}
# Frecuencias
sjmisc::frq(elsoc_procjv$jv_trabaj_2019)
```


###### Recodificación

```{r}
# Recoficiación NA
elsoc_procjv$jv_trabaj_2019<- set_na(elsoc_procjv$jv_trabaj_2019, na = c(-888,-999), drop.levels = TRUE, as.tag = FALSE)

# Creación variable factor
elsoc_procjv$jv_trabaj_2019_factor <- factor(elsoc_procjv$jv_trabaj_2019, levels = c(1,2,3,4,5), labels = c("Nunca se justifica", "Pocas veces se justifica", "Algunas veces se justifica", "Muchas veces se justifica", "Siempre se justifica"))

```


###### Descriptivo final

```{r}

# Variable original (númerica)
sjmisc::frq(elsoc_procjv$jv_trabaj_2019)

# Variable factor
sjmisc::frq(elsoc_procjv$jv_trabaj_2019_factor)
```


##### Daño inmobiliario público

###### Descriptivo

```{r}
# Frecuencias
sjmisc::frq(elsoc_procjv$jv_prop1_2019)
```


###### Recodificación

```{r}
# Recoficiación NA
elsoc_procjv$jv_prop1_2019<- set_na(elsoc_procjv$jv_prop1_2019, na = c(-888,-999), drop.levels = TRUE, as.tag = FALSE)

# Creación variable factor
elsoc_procjv$jv_prop1_2019_factor <- factor(elsoc_procjv$jv_prop1_2019, levels = c(1,2,3,4,5), labels = c("Nunca se justifica", "Pocas veces se justifica", "Algunas veces se justifica", "Muchas veces se justifica", "Siempre se justifica"))

```


###### Descriptivo final

```{r}

# Variable original (númerica)
sjmisc::frq(elsoc_procjv$jv_prop1_2019)

# Variable factor
sjmisc::frq(elsoc_procjv$jv_prop1_2019_factor)
```


##### Daño transporte público

###### Descriptivo

```{r}
# Frecuencias
sjmisc::frq(elsoc_procjv$jv_prop2_2019)
```


###### Recodificación

```{r}
# Recoficiación NA
elsoc_procjv$jv_prop2_2019<- set_na(elsoc_procjv$jv_prop2_2019, na = c(-888,-999), drop.levels = TRUE, as.tag = FALSE)

# Creación variable factor
elsoc_procjv$jv_prop2_2019_factor <- factor(elsoc_procjv$jv_prop2_2019, levels = c(1,2,3,4,5), labels = c("Nunca se justifica", "Pocas veces se justifica", "Algunas veces se justifica", "Muchas veces se justifica", "Siempre se justifica"))

```


###### Descriptivo final

```{r}

# Variable original (númerica)
sjmisc::frq(elsoc_procjv$jv_prop2_2019)

# Variable factor
sjmisc::frq(elsoc_procjv$jv_prop2_2019_factor)
```


##### Daño comercio

###### Descriptivo

```{r}
# Frecuencias
sjmisc::frq(elsoc_procjv$jv_prop3_2019)
```


###### Recodificación

```{r}
# Recoficiación NA
elsoc_procjv$jv_prop3_2019<- set_na(elsoc_procjv$jv_prop3_2019, na = c(-888,-999), drop.levels = TRUE, as.tag = FALSE)

# Creación variable factor
elsoc_procjv$jv_prop3_2019_factor <- factor(elsoc_procjv$jv_prop3_2019, levels = c(1,2,3,4,5), labels = c("Nunca se justifica", "Pocas veces se justifica", "Algunas veces se justifica", "Muchas veces se justifica", "Siempre se justifica"))

```


###### Descriptivo final

```{r}

# Variable original (númerica)
sjmisc::frq(elsoc_procjv$jv_prop3_2019)

# Variable factor
sjmisc::frq(elsoc_procjv$jv_prop3_2019_factor)
```


###### Otros ajutes

```{r Crear indice}

# Crear indice sumativo con las tres variables de daño a la propiedad
elsoc_procjv$prop_index <- (as.numeric(elsoc_procjv$jv_prop1_2019) + as.numeric(elsoc_procjv$jv_prop2_2019) + as.numeric(elsoc_procjv$jv_prop3_2019))

# Cambiar etiqueta

elsoc_procjv$prop_index <- set_label(x = elsoc_procjv$prop_index, label = "Indice sumativo de justificación de daño a la propiedad")

# Descriptivo de la variable nueva

sjmisc::descr(elsoc_procjv$prop_index,
      show = c("label","range", "mean", "sd", "NA.prc", "n"))%>%
      kable(.,"markdown")

sjmisc::frq(elsoc_procjv$prop_index)

# Density plot 
ggplot(elsoc_procjv, aes(x=prop_index))+
  geom_density(color="darkblue", fill="lightblue")


```

### Variables independientes

#### Percepción trato justo

##### Trato respetuoso en servicios de salud

###### Descriptivo
```{r}

# Frecuencias

sjmisc::frq(elsoc_procjv$trato_salud)

```

###### Recodificación

```{r}
# Recoficiación NA
elsoc_procjv$trato_salud<- set_na(elsoc_procjv$trato_salud, na = c(-888,-999), drop.levels = TRUE, as.tag = FALSE)

# Creación variable factor
elsoc_procjv$trato_salud_factor <- factor(elsoc_procjv$trato_salud, levels = c(1,2,3,4,5), labels = c("Nunca se justifica", "Pocas veces se justifica", "Algunas veces se justifica", "Muchas veces se justifica", "Siempre se justifica"))

```

##### Trato respetuoso en el trabajo
##### Trato respetuoso carabineros
##### Trato respetuoso clase alta


#### Justicia distributiva
##### Justicia distributiva pensiones
##### Justicia distributiva educación hijos
##### Justicia distributiva salud
##### Salario percibido CEO
##### Salario percibido obrero
##### Salario justo CEO
##### Salario justo obrero
##### Justificación diferencias clases

#### Grupos desventajados
##### Ingresos
##### Ingresos tramos
##### Ingreso justo
##### Educ
##### Sexo

### Variables de control
##### Edad del entrevistado
##### Comuna de residencia
##### Posición política
##### Frecuencia participación marchas
##### Frecuencia participación huelgas
##### Religión del entrevistado
##### Religión otro del entrevistado